# TESTCASES.md — Тест-кейсы API микросервиса объявлений

## Содержание

1. [Создание объявления (POST /api/1/item)](#1-создание-объявления-post-api1item)
   - [1: Успешное создание объявления](#1-успешное-создание-объявления)
   - [2: Создание объявления с некорректным sellerID](#2-создание-объявления-с-некорректным-sellerid)
   - [3: Создание объявления без обязательных полей](#3-создание-объявления-без-обязательных-полей)
2. [Получение объявления по ID (GET /api/1/item/:id)](#2-получение-объявления-по-id-get-api1itemid)
   - [4: Успешное получение объявления](#4-успешное-получение-объявления)
   - [5: Запрос несуществующего объявления](#5-запрос-несуществующего-объявления)
   - [6: Некорректный формат ID](#6-некорректный-формат-id)
3. [Получение всех объявлений по sellerID (GET /api/1/:sellerID/item)](#3-получение-всех-объявлений-по-sellerid-get-api1selleriditem)
   - [7: Получение объявлений для существующего продавца](#7-получение-объявлений-для-существующего-продавца)
   - [8: Запрос с некорректным форматом sellerID](#8-запрос-с-некорректным-форматом-sellerid)
   - [9: Получение объявлений, если у продавца их нет](#9-получение-объявлений-если-у-продавца-их-нет)
4. [Получение статистики по объявлению через V1 (GET /api/1/statistic/:id)](#4-получение-статистики-по-объявлению-через-v1-get-api1statisticid)
   - [10: Успешное получение статистики (V1)](#10-успешное-получение-статистики-v1)
   - [11: Запрос статистики для несуществующего объявления (V1)](#11-запрос-статистики-для-несуществующего-объявления-v1)
   - [12: Некорректный формат ID для статистики (V1)](#12-некорректный-формат-id-для-статистики-v1)
5. [Получение статистики по объявлению через V2 (GET /api/2/statistic/:id)](#5-получение-статистики-по-объявлению-через-v2-get-api2statisticid)
   - [13: Успешное получение статистики (V2)](#13-успешное-получение-статистики-v2)
   - [14: Запрос статистики для несуществующего объявления (V2)](#14-запрос-статистики-для-несуществующего-объявления-v2)
   - [15: Некорректный формат ID для статистики (V2)](#15-некорректный-формат-id-для-статистики-v2)
6. [Удаление объявления (DELETE /api/2/item/:id)](#6-удаление-объявления-delete-api2itemid)
   - [16: Успешное удаление объявления](#16-успешное-удаление-объявления)
   - [16_1: Удаление объявления с использованием идентификатора, извлечённого из поля "status"](#16_1-удаление-объявления-с-использованием-идентификатора-извлечённого-из-поля-status)
   - [17: Удаление несуществующего объявления](#17-удаление-несуществующего-объявления)

---

## 1. Создание объявления (POST /api/1/item)

### 1: Успешное создание объявления

**Предварительные условия:**
- Сервис доступен по адресу: `https://qa-internship.avito.com/api/1/item`.
- Используется корректный `sellerID` (в диапазоне 111111–999999).

**Шаги:**
1. Отправить `POST`-запрос с телом:
   ```json
   {
     "sellerID": 1234345231,
     "name": "dsds",
     "price": 1,
     "statistics": {
       "contacts": 3,
       "likes": 123,
       "viewCount": 12
     }
   }
   ```
2. Проверить, что код ответа равен `200`.
3. Убедиться, что в ответе присутствует поле `"status"` с сообщением (например, `"Сохранили объявление - <UUID>"`).

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа содержит поле `"status"`.

---

### 2: Создание объявления с некорректным sellerID

**Шаги:**
1. Отправить `POST`-запрос с телом:
   ```json
   {
     "sellerID": "abc123",
     "name": "TestInvalidSeller",
     "price": 100
   }
   ```
2. Проверить, что код ответа равен `400`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"` с описанием ошибки.

**Ожидаемый результат:**
- HTTP-статус 400.
- Тело ответа содержит поля `"result"` и `"status"`.

---

### 3: Создание объявления без обязательных полей

**Шаги:**
1. Отправить `POST`-запрос без полей `name` и `price`:
   ```json
   {
     "sellerID": 1234345231
   }
   ```
2. Проверить, что код ответа равен `400`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 400.
- Тело ответа содержит поля `"result"` и `"status"`.

---

## 2. Получение объявления по ID (GET /api/1/item/:id)

### 4: Успешное получение объявления

**Предварительные условия:**
- Существует объявление с ID, например: `0cd4183f-a699-4486-83f8-b513dfde477a`.

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/item/0cd4183f-a699-4486-83f8-b513dfde477a`.
2. Проверить, что код ответа равен `200`.
3. Убедиться, что в ответе получен массив объектов с полями:
   - `id`
   - `sellerId`
   - `name`
   - `price`
   - `statistics` (объект с полями `likes`, `viewCount`, `contacts`)
   - `createdAt`

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа — массив объектов с перечисленными полями.

---

### 5: Запрос несуществующего объявления

**Шаги:**
1. Использовать несуществующий ID, например: `00000000-0000-0000-0000-000000000000`.
2. Отправить `GET`-запрос на `/api/1/item/<fake_id>`.
3. Проверить, что код ответа равен `404`.
4. Убедиться, что в ответе присутствуют поля `"result"` и `"status"` с информацией об ошибке.

**Ожидаемый результат:**
- HTTP-статус 404.
- Тело ответа содержит `"result"` и `"status"`.

---

### 6: Некорректный формат ID

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/item/12345`.
2. Проверить, что код ответа равен `400` или `404`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 400 или 404.
- Тело ответа содержит поля `"result"` и `"status"` с описанием ошибки.

---

## 3. Получение всех объявлений по sellerID (GET /api/1/:sellerID/item)

### 7: Получение объявлений для существующего продавца

**Предварительные условия:**
- У продавца с `sellerID` (например, `1234345231`) есть хотя бы одно объявление.

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/1234345231/item`.
2. Проверить, что код ответа равен `200`.
3. Убедиться, что в ответе получен массив объектов с полями:
   - `id`
   - `sellerId`
   - `name`
   - `price`
   - `statistics`
   - `createdAt`

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа — массив объявлений.

---

### 8: Запрос с некорректным форматом sellerID

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/abc123/item`.
2. Проверить, что код ответа равен `400`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 400.
- Тело ответа содержит поля `"result"` и `"status"`.

---

### 9: Получение объявлений, если у продавца их нет

**Шаги:**
1. Использовать sellerID, для которого гарантированно отсутствуют объявления (например, `999999999`).
2. Отправить `GET`-запрос на `/api/1/999999999/item`.
3. Проверить, что код ответа равен `200`.
4. Убедиться, что в ответе получен пустой массив `[]`.

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа — пустой массив.

---

## 4. Получение статистики по объявлению через V1 (GET /api/1/statistic/:id)

### 10: Успешное получение статистики (V1)

**Предварительные условия:**
- Объявление с ID, например, `0cd4183f-a699-4486-83f8-b513dfde477a`, существует и имеет статистику.

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/statistic/0cd4183f-a699-4486-83f8-b513dfde477a`.
2. Проверить, что код ответа равен `200`.
3. Убедиться, что в ответе получен массив объектов, где у каждого объекта присутствуют поля:
   - `likes`
   - `viewCount`
   - `contacts`

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа — массив объектов статистики с указанными полями.

---

### 11: Запрос статистики для несуществующего объявления (V1)

**Шаги:**
1. Использовать несуществующий ID, например: `00000000-0000-0000-0000-000000000001`.
2. Отправить `GET`-запрос на `/api/1/statistic/<fake_id>`.
3. Проверить, что код ответа равен `404`.
4. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 404.
- Тело ответа содержит `"result"` и `"status"`.

---

### 12: Некорректный формат ID для статистики (V1)

**Шаги:**
1. Отправить `GET`-запрос на `/api/1/statistic/not-uuid`.
2. Проверить, что код ответа равен `400` или `404`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 400 или 404.
- Тело ответа содержит поля `"result"` и `"status"`.

---

## 5. Получение статистики по объявлению через V2 (GET /api/2/statistic/:id)

### 13: Успешное получение статистики (V2)

**Предварительные условия:**
- Объявление с ID, например, `0cd4183f-a699-4486-83f8-b513dfde477a`, существует и имеет статистические данные.

**Шаги:**
1. Отправить `GET`-запрос на `/api/2/statistic/0cd4183f-a699-4486-83f8-b513dfde477a`.
2. Проверить, что код ответа равен `200`.
3. Убедиться, что в ответе получен массив объектов, где присутствуют поля:
   - `likes`
   - `viewCount`
   - `contacts`

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа — массив объектов статистики с соответствующими полями.

---

### 14: Запрос статистики для несуществующего объявления (V2)

**Шаги:**
1. Использовать несуществующий ID, например: `00000000-0000-0000-0000-000000000001`.
2. Отправить `GET`-запрос на `/api/2/statistic/<fake_id>`.
3. Проверить, что код ответа равен `404`.
4. Убедиться, что в ответе содержатся поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 404.
- Тело ответа содержит `"result"` и `"status"`.

---

### 15: Некорректный формат ID для статистики (V2)

**Шаги:**
1. Отправить `GET`-запрос на `/api/2/statistic/not-uuid`.
2. Проверить, что код ответа равен `400` или `404`.
3. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 400 или 404.
- Тело ответа содержит поля `"result"` и `"status"`.

---

## 6. Удаление объявления (DELETE /api/2/item/:id)

### 16: Успешное удаление объявления

**Предварительные условия:**
- Объявление создаётся через `POST /api/1/item` и в ответе возвращается поле `"id"`.

**Шаги:**
1. Создать объявление с данными:
   ```json
   {
     "sellerID": 999999,
     "name": "Test Ad to Delete",
     "price": 123,
     "statistics": {
       "likes": 0,
       "viewCount": 0,
       "contacts": 0
     }
   }
   ```
2. Извлечь поле `"id"` из ответа.
3. Отправить `DELETE`-запрос на `/api/2/item/<id>`.
4. Проверить, что код ответа равен `200` и тело ответа пустое.

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа пустое.

---

### 16_1: Удаление объявления с использованием идентификатора, извлечённого из поля "status"

**Предварительные условия:**
- Если при создании объявления через `POST /api/1/item` поле `"id"` отсутствует, то ожидается, что в поле `"status"` вернётся строка вида:
  ```
  "Сохранили объявление - <uuid>"
  ```
  Из этой строки необходимо извлечь `<uuid>`.

**Шаги:**
1. Создать объявление с данными:
   ```json
   {
     "sellerID": 999999,
     "name": "Test Ad to Delete",
     "price": 123,
     "statistics": {
       "likes": 0,
       "viewCount": 0,
       "contacts": 0
     }
   }
   ```
2. Получить ответ от сервера. Если поле `"id"` отсутствует, извлечь идентификатор из поля `"status"` (разбив строку по `" - "` и взяв последний элемент).
3. Использовать полученный идентификатор для отправки `DELETE`-запроса на `/api/2/item/<id>`.
4. Проверить, что код ответа равен `200` и тело ответа пустое.

**Ожидаемый результат:**
- HTTP-статус 200.
- Тело ответа пустое.

---

### 17: Удаление несуществующего объявления

**Шаги:**
1. Использовать несуществующий ID, например: `00000000-0000-0000-0000-000000000099`.
2. Отправить `DELETE`-запрос на `/api/2/item/<fake_id>`.
3. Проверить, что код ответа равен `404`.
4. Убедиться, что в ответе присутствуют поля `"result"` и `"status"`.

**Ожидаемый результат:**
- HTTP-статус 404.
- Тело ответа содержит `"result"` и `"status"`.

---

## Резюме

- **Раздел 1 (тесты 1–3):** Проверяет сценарии создания объявления через `POST /api/1/item` с корректными данными и обработку невалидных/неполных данных.
- **Раздел 2 (тесты 4–6):** Покрывает получение одного объявления по ID через `GET /api/1/item/:id`.
- **Раздел 3 (тесты 7–9):** Проверяет получение всех объявлений для продавца через `GET /api/1/:sellerID/item`.
- **Раздел 4 (тесты 10–12):** Тестирует получение статистики через `GET /api/1/statistic/:id` (V1).
- **Раздел 5 (тесты 13–15):** Тестирует получение статистики через `GET /api/2/statistic/:id` (V2).
- **Раздел 6 (тесты 16, 16.1, 17):** Описывает сценарии удаления объявления через `DELETE /api/2/item/:id`:
  - Тест 16 проверяет удаление с использованием поля `"id"` из ответа на создание.
  - Тест 16.1 проверяет удаление с извлечением идентификатора из поля `"status"`, если `"id"` отсутствует.
  - Тест 17 проверяет удаление несуществующего объявления.


Этот документ можно использовать как основу для ручного тестирования, а также для автоматизированного тестирования с использованием Python и библиотеки `pytest`.
